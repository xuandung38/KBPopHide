# Release Quick Reference Guide

**Purpose**: Fast lookup for release procedures and common tasks
**Audience**: Release engineers, project leads
**Last Updated**: 2026-01-05

## Release Checklist

Before creating a release:

```
PRE-RELEASE CHECKLIST
└── Code Ready
    ├── All tests passing (swift test)
    ├── Build succeeds (swift build -c release)
    ├── No uncommitted changes
    └── All features merged to main

└── Documentation Updated
    ├── CHANGELOG.md has new section
    ├── Version number consistent
    ├── Release notes prepared
    └── Known issues documented

└── Configuration Verified
    ├── Info.plist version matches CHANGELOG
    ├── EdDSA keys valid (bin/prepare-release.sh)
    ├── GitHub Secrets configured
    └── GitHub Pages enabled

└── Approval
    ├── Code review complete
    ├── Release approved by maintainer
    ├── No critical issues open
    └── Stakeholders notified
```

## One-Command Release

Quick procedure for experienced release engineers:

```bash
# 1. Prepare
cd /Users/hxd/Develop/kbpophide/KSAPDismiss
./bin/prepare-release.sh

# 2. Update version (example: 1.1.3)
/usr/libexec/PlistBuddy -c "Set :CFBundleShortVersionString 1.1.3" KSAPDismiss/Info.plist

# 3. Update CHANGELOG
# Edit CHANGELOG.md: Move [Unreleased] items to [1.1.3] section

# 4. Commit
git add CHANGELOG.md KSAPDismiss/Info.plist
git commit -m "chore: bump version to v1.1.3"

# 5. Tag and push
git tag -a v1.1.3 -m "Release v1.1.3"
git push origin main v1.1.3

# 6. Monitor
open https://github.com/xuandung38/ksap-dismiss/actions

# Done! GitHub Actions will handle the rest (5-10 minutes)
```

## File Reference

### Files to Modify for Release

| File | Change | Example |
|------|--------|---------|
| `CHANGELOG.md` | Add version section | `## [1.1.3] - 2026-01-10` |
| `KSAPDismiss/Info.plist` | Update version | `CFBundleShortVersionString = 1.1.3` |
| `.github/workflows/release.yml` | Monitor (read-only) | No changes needed |
| `docs/appcast.xml` | Auto-generated (don't edit) | Generated by GitHub Actions |
| `bin/prepare-release.sh` | Run to validate | No changes needed |

### Files Generated by GitHub Actions

| File | Purpose | Created By | View At |
|------|---------|-----------|---------|
| `.dmg` (DMG) | Installer | build-and-release job | GitHub Release |
| `.dmg.edSignature` | EdDSA signature | build-and-release job | GitHub Release |
| `docs/appcast.xml` | Update feed | build-and-release job | GitHub Pages |
| Release notes | GitHub Release | build-and-release job | GitHub Release |

## Commands Quick Reference

### Check Current Version

```bash
# Get version from Info.plist
/usr/libexec/PlistBuddy -c "Print :CFBundleShortVersionString" KSAPDismiss/Info.plist

# Get version from CHANGELOG
grep "^\[" CHANGELOG.md | head -1
```

### Update Version

```bash
# Set to X.Y.Z
/usr/libexec/PlistBuddy -c "Set :CFBundleShortVersionString X.Y.Z" KSAPDismiss/Info.plist

# Verify
/usr/libexec/PlistBuddy -c "Print :CFBundleShortVersionString" KSAPDismiss/Info.plist
```

### Create Release Tag

```bash
# Create annotated tag
git tag -a vX.Y.Z -m "Release vX.Y.Z"

# Push tag (triggers workflow)
git push origin vX.Y.Z

# Or both at once
git push origin main vX.Y.Z
```

### Monitor Workflow

```bash
# Option 1: Web browser
open https://github.com/xuandung38/ksap-dismiss/actions

# Option 2: Command line
gh run list --workflow=release.yml --limit=5

# Option 3: Watch specific run
gh run watch <run-id>
```

### Check Release Status

```bash
# List recent releases
gh release list

# View specific release
gh release view vX.Y.Z

# List release assets
gh release view vX.Y.Z --json assets
```

## Troubleshooting Quick Links

| Issue | Solution |
|-------|----------|
| Build fails | Run `swift build -c release` locally |
| DMG creation fails | Check disk space: `df -h /` |
| Signing fails | Verify private key: `bin/prepare-release.sh` |
| GitHub Pages 404 | Check `gh-pages` branch, wait 5 minutes |
| Release doesn't show | Check workflow status, re-push tag if needed |
| Auto-update not working | Check Info.plist SUFeedURL, verify appcast.xml |

## Environment Setup

### Required Tools

```bash
# Check all tools installed
command -v swift      # Swift compiler
command -v git        # Git version control
command -v gh         # GitHub CLI
command -v create-dmg # DMG creator (GitHub Actions installs)
```

### GitHub Configuration

```bash
# Set GitHub CLI to correct repository
gh repo set-default xuandung38/ksap-dismiss

# Verify secrets configured
gh secret list

# Should show: SPARKLE_PRIVATE_KEY
```

## Version Format

### Release Version

Use semantic versioning: `X.Y.Z`

- **X** = Major (breaking changes)
- **Y** = Minor (new features)
- **Z** = Patch (bug fixes)

Examples:
- `v1.0.0` - First release
- `v1.1.0` - New feature
- `v1.1.1` - Bug fix
- `v2.0.0` - Major update

### Git Tag Format

Always use: `vX.Y.Z`

```bash
# Correct
git tag -a v1.1.3 -m "Release v1.1.3"

# Incorrect (won't trigger workflow)
git tag -a 1.1.3 -m "Release 1.1.3"
git tag -a release-1.1.3 -m "Release 1.1.3"
```

### CHANGELOG Format

```markdown
## [X.Y.Z] - YYYY-MM-DD

### Added
- Feature A
- Feature B

### Changed
- Change A

### Fixed
- Bug fix A

### Removed
- Removed feature A
```

## GitHub Actions Workflow

### Automatic Steps (Triggered by Tag Push)

1. **Checkout** - Clone repository
2. **Setup** - Install Xcode, tools
3. **Build** - Compile release binary (arm64 + x86_64)
4. **DMG** - Create installer package
5. **Download** - Get Sparkle signing tools
6. **Sign** - EdDSA sign DMG file
7. **Appcast** - Generate update feed XML
8. **Deploy** - Publish to GitHub Pages
9. **Release** - Create GitHub Release

**Total time**: 5-10 minutes

### Success Indicators

- [x] All jobs pass (green checkmarks)
- [x] DMG file appears in Release
- [x] EdSignature file appears in Release
- [x] appcast.xml updated on GitHub Pages
- [x] Release notes populated

### Failure Indicators

- ✗ Any job fails (red X)
- ✗ No DMG in Release
- ✗ GitHub Pages 404 error
- ✗ appcast.xml not updated

## Performance Notes

| Task | Duration | Notes |
|------|----------|-------|
| Local prep | 5 min | Run prepare-release.sh |
| GitHub Actions | 5-10 min | Full build + deploy |
| GitHub Pages | 1-5 min | CDN propagation |
| Total | 11-20 min | From tag to users |

## URLs Quick Reference

### Key URLs

| Resource | URL |
|----------|-----|
| Repository | https://github.com/xuandung38/ksap-dismiss |
| Releases Page | https://github.com/xuandung38/ksap-dismiss/releases |
| Actions (CI/CD) | https://github.com/xuandung38/ksap-dismiss/actions |
| GitHub Pages | https://xuandung38.github.io/ksap-dismiss/ |
| Appcast Feed | https://xuandung38.github.io/ksap-dismiss/appcast.xml |

### Configuration URLs

| Setting | URL |
|---------|-----|
| Secrets | https://github.com/xuandung38/ksap-dismiss/settings/secrets/actions |
| Pages | https://github.com/xuandung38/ksap-dismiss/settings/pages |
| Actions | https://github.com/xuandung38/ksap-dismiss/settings/actions |

## Emergency Procedures

### Rollback a Release (Quick)

```bash
# 1. Delete tag locally and remote
git tag -d v1.1.3
git push --delete origin v1.1.3

# 2. Edit appcast.xml manually
# Remove the release entry from docs/appcast.xml

# 3. Commit and push
git add docs/appcast.xml
git commit -m "chore: rollback appcast for v1.1.3"
git push origin main

# 4. Delete GitHub Release
gh release delete v1.1.3 -y
```

### Hotfix Release (Fast Path)

```bash
# 1. Fix the bug
# (make changes to code)

# 2. Update version (e.g., v1.1.4)
/usr/libexec/PlistBuddy -c "Set :CFBundleShortVersionString 1.1.4" KSAPDismiss/Info.plist

# 3. Add CHANGELOG entry
# Add [1.1.4] - 2026-01-05 section

# 4. Quick release
git add CHANGELOG.md KSAPDismiss/Info.plist
git commit -m "chore: bump version to v1.1.4"
git tag -a v1.1.4 -m "Hotfix v1.1.4"
git push origin main v1.1.4

# 5. Monitor
open https://github.com/xuandung38/ksap-dismiss/actions
```

## Verification Commands

### Pre-Release Verification

```bash
# All tests pass
swift test

# Build succeeds
swift build -c release

# Version matches
/usr/libexec/PlistBuddy -c "Print :CFBundleShortVersionString" KSAPDismiss/Info.plist
grep "^\[" CHANGELOG.md | head -1

# Git status clean
git status

# Keys valid
./bin/prepare-release.sh
```

### Post-Release Verification

```bash
# Release created
gh release view v1.1.3

# Assets present
gh release view v1.1.3 --json assets

# Appcast updated
curl https://xuandung38.github.io/ksap-dismiss/appcast.xml | xmllint --format -

# App can update (test manually)
# Menu bar → Check for Updates
```

## Document References

For detailed information, see:

| Task | Document | Section |
|------|----------|---------|
| Full release process | deployment-guide.md | Release Process |
| GitHub Actions details | release-workflow.md | Workflow Details |
| Sparkle auto-update | sparkle-integration.md | Update Checking |
| Troubleshooting | deployment-guide.md | Troubleshooting |
| Version management | deployment-guide.md | Version Management |
| EdDSA signing | sparkle-integration.md | EdDSA Signature Details |

## Support & Questions

**GitHub Issues**: https://github.com/xuandung38/ksap-dismiss/issues
**Email**: me@hxd.vn

For detailed procedures, refer to full documentation in `./docs/`

---

**Last Updated**: 2026-01-05
**Version**: 1.0
**Status**: Production-ready
